<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Number Lookup | Punjab Investigation Tools</title>
    <meta name="description" content="Identify country, region, and telecom operator from phone numbers. Comprehensive Indian mobile operator database with 1700+ prefix records.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/tool-common.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Loading Operator Database</h3>
            <p>Please wait while we load 1700+ Indian mobile operator records...</p>
        </div>
    </div>

    <!-- Lookup Spinner Overlay -->
    <div class="loading-overlay hidden" id="lookupSpinner">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="lookupSpinnerTitle">Looking up phone number...</h3>
            <p id="lookupSpinnerStatus">Checking carrier databases...</p>
        </div>
    </div>

    <header class="header">
        <div class="header-container">
            <a href="/" class="logo" style="text-decoration: none; color: inherit;">
                <div class="logo-icon">
                    <i class="fas fa-shield-halved"></i>
                </div>
                <div class="logo-text">
                    <span class="logo-title">Punjab Investigation Tools</span>
                    <span class="logo-subtitle">Phone Number Lookup</span>
                </div>
            </a>
            <div class="header-actions">
                <a href="/" class="back-home-btn">
                    <i class="fas fa-home"></i> All Tools
                </a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section class="hero-section">
            <div class="hero-content">
                <h1><i class="fas fa-phone"></i> Phone Number Lookup</h1>
                <p>Identify country, region, and telecom operator from phone numbers</p>
            </div>
        </section>

        <section class="input-section">
            <div class="input-group">
                <h3><i class="fas fa-keyboard"></i> Enter Phone Number</h3>
                <div class="input-row">
                    <input type="text" id="phoneInput" class="input-field" placeholder="+91 98765 43210 or 9876543210" maxlength="20" disabled>
                    <button class="verify-btn" onclick="lookupPhone()" id="lookupBtn" disabled>
                        <i class="fas fa-search"></i> Lookup
                    </button>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> Enter with or without country code. Indian numbers are assumed if no country code provided.
                </p>
                <p style="color: var(--accent-color); font-size: 0.85rem; margin-top: 5px;" id="dbStatus">
                    <i class="fas fa-database"></i> Loading operator database...
                </p>
            </div>
        </section>

        <section class="results-section" id="resultsSection" style="display: none;">
            <div class="result-card" id="resultCard">
                <div class="result-header">
                    <div class="result-icon valid" id="resultIcon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="result-title">
                        <h3 id="resultTitle">Phone Number Analysis</h3>
                        <p id="resultSubtitle">Information retrieved</p>
                    </div>
                </div>

                <div class="result-details" id="resultDetails">
                    <!-- Results will be populated here -->
                </div>
                
                <div id="operatorBreakdown" style="margin-top: 20px; padding: 20px; background: rgba(99, 102, 241, 0.1); border-radius: 12px;"></div>
                
                <!-- Jio Live Check Section -->
                <div id="jioLiveCheck" style="margin-top: 20px; display: none;">
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(10, 40, 133, 0.2) 0%, rgba(26, 71, 192, 0.2) 100%); border: 1px solid rgba(10, 40, 133, 0.4); border-radius: 12px;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">
                            <i class="fas fa-satellite-dish"></i> Jio Live Status Check
                        </h4>
                        <div id="jioCheckContent">
                            <div style="text-align: center; padding: 20px;">
                                <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                                <p style="color: var(--text-secondary);">Checking Jio network status...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- BSNL Live Check Section -->
                <div id="bsnlLiveCheck" style="margin-top: 20px; display: none;">
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 152, 0, 0.15) 100%); border: 1px solid rgba(255, 193, 7, 0.4); border-radius: 12px;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">
                            <i class="fas fa-broadcast-tower"></i> BSNL Live Status Check
                        </h4>
                        <div id="bsnlCheckContent">
                            <div style="text-align: center; padding: 20px;">
                                <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                                <p style="color: var(--text-secondary);">Checking BSNL network status...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Airtel Live Check Section -->
                <div id="airtelLiveCheck" style="margin-top: 20px; display: none;">
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(237, 28, 36, 0.15) 0%, rgba(180, 0, 0, 0.15) 100%); border: 1px solid rgba(237, 28, 36, 0.4); border-radius: 12px;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">
                            <i class="fas fa-signal"></i> Airtel Live Status Check
                        </h4>
                        <div id="airtelCheckContent">
                            <div style="text-align: center; padding: 20px;">
                                <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                                <p style="color: var(--text-secondary);">Checking Airtel network status...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vi Live Check Section -->
                <div id="viLiveCheck" style="margin-top: 20px; display: none;">
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(255, 0, 102, 0.15) 0%, rgba(153, 0, 204, 0.15) 100%); border: 1px solid rgba(255, 0, 102, 0.4); border-radius: 12px;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">
                            <i class="fas fa-wifi"></i> Vi Live Status Check
                        </h4>
                        <div id="viCheckContent">
                            <div style="text-align: center; padding: 20px;">
                                <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                                <p style="color: var(--text-secondary);">Checking Vi network status...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="mnpWarningBox" class="warning-box">
                <h4><i class="fas fa-triangle-exclamation"></i> Important: Mobile Number Portability (MNP)</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>Numbers can be ported</strong> - The operator shown is based on original allocation and may not reflect current operator</li>
                    <li>In India, MNP allows users to switch operators while keeping their number</li>
                    <li>For accurate current operator information, official carrier verification is required</li>
                    <li>Circle/region information is based on original number allocation</li>
                    <li>Virtual numbers and VoIP services may show different information</li>
                </ul>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="copyResult()">
                    <i class="fas fa-copy"></i> Copy Result
                </button>
                <button class="action-btn" onclick="downloadPDF()">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </button>
                <button class="action-btn" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Check Another
                </button>
            </div>
        </section>

        <section class="info-section">
            <h3><i class="fas fa-info-circle"></i> About Phone Numbers</h3>
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-globe"></i></div>
                    <h4>Country Codes</h4>
                    <p>International phone numbers start with a country code (e.g., +91 for India, +1 for USA). This helps identify the country of origin.</p>
                </div>
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <h4>Number Series</h4>
                    <p>In India, mobile numbers are allocated in series to different operators and circles. The first 4 digits indicate the original operator and region.</p>
                </div>
                <div class="info-card">
                    <div class="info-icon"><i class="fas fa-exchange-alt"></i></div>
                    <h4>Number Portability</h4>
                    <p>MNP allows users to change operators while keeping their number. The prefix may not reflect the current operator after porting.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p><i class="fas fa-database"></i> Database lookup is local. <i class="fas fa-cloud"></i> Phone numbers are sent to Jio & BSNL servers for live verification.</p>
            <p>Â© 2024-<span id="currentYear"></span> Punjab Investigation Tools | Data source: hstsethi/in-mob-prefix (CC BY 4.0)</p>
        </div>
    </footer>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Action completed</span>
    </div>

    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 20, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading-content {
            text-align: center;
            color: var(--text-primary);
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(99, 102, 241, 0.3);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-content h3 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .loading-content p {
            color: var(--text-secondary);
        }
        .operator-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .operator-logo.airtel { background: linear-gradient(135deg, #ed1c24 0%, #ff5c5c 100%); color: white; }
        .operator-logo.jio { background: linear-gradient(135deg, #0a2885 0%, #1a47c0 100%); color: white; }
        .operator-logo.vi { background: linear-gradient(135deg, #e60000 0%, #ffcb05 100%); color: white; }
        .operator-logo.bsnl { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #333; }
        .operator-logo.mtnl { background: linear-gradient(135deg, #00a0e3 0%, #005baa 100%); color: white; }
        .operator-logo.other { background: linear-gradient(135deg, #6b7280 0%, #374151 100%); color: white; }
    </style>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Global variables
        let indianMobileDB = {};
        let dbEntryCount = 0;

        // Country codes database (comprehensive)
        const countryCodes = {
            '1': { country: 'United States/Canada', flag: 'ðŸ‡ºðŸ‡¸', code: '+1' },
            '7': { country: 'Russia/Kazakhstan', flag: 'ðŸ‡·ðŸ‡º', code: '+7' },
            '20': { country: 'Egypt', flag: 'ðŸ‡ªðŸ‡¬', code: '+20' },
            '27': { country: 'South Africa', flag: 'ðŸ‡¿ðŸ‡¦', code: '+27' },
            '30': { country: 'Greece', flag: 'ðŸ‡¬ðŸ‡·', code: '+30' },
            '31': { country: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±', code: '+31' },
            '32': { country: 'Belgium', flag: 'ðŸ‡§ðŸ‡ª', code: '+32' },
            '33': { country: 'France', flag: 'ðŸ‡«ðŸ‡·', code: '+33' },
            '34': { country: 'Spain', flag: 'ðŸ‡ªðŸ‡¸', code: '+34' },
            '36': { country: 'Hungary', flag: 'ðŸ‡­ðŸ‡º', code: '+36' },
            '39': { country: 'Italy', flag: 'ðŸ‡®ðŸ‡¹', code: '+39' },
            '40': { country: 'Romania', flag: 'ðŸ‡·ðŸ‡´', code: '+40' },
            '41': { country: 'Switzerland', flag: 'ðŸ‡¨ðŸ‡­', code: '+41' },
            '43': { country: 'Austria', flag: 'ðŸ‡¦ðŸ‡¹', code: '+43' },
            '44': { country: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§', code: '+44' },
            '45': { country: 'Denmark', flag: 'ðŸ‡©ðŸ‡°', code: '+45' },
            '46': { country: 'Sweden', flag: 'ðŸ‡¸ðŸ‡ª', code: '+46' },
            '47': { country: 'Norway', flag: 'ðŸ‡³ðŸ‡´', code: '+47' },
            '48': { country: 'Poland', flag: 'ðŸ‡µðŸ‡±', code: '+48' },
            '49': { country: 'Germany', flag: 'ðŸ‡©ðŸ‡ª', code: '+49' },
            '51': { country: 'Peru', flag: 'ðŸ‡µðŸ‡ª', code: '+51' },
            '52': { country: 'Mexico', flag: 'ðŸ‡²ðŸ‡½', code: '+52' },
            '53': { country: 'Cuba', flag: 'ðŸ‡¨ðŸ‡º', code: '+53' },
            '54': { country: 'Argentina', flag: 'ðŸ‡¦ðŸ‡·', code: '+54' },
            '55': { country: 'Brazil', flag: 'ðŸ‡§ðŸ‡·', code: '+55' },
            '56': { country: 'Chile', flag: 'ðŸ‡¨ðŸ‡±', code: '+56' },
            '57': { country: 'Colombia', flag: 'ðŸ‡¨ðŸ‡´', code: '+57' },
            '58': { country: 'Venezuela', flag: 'ðŸ‡»ðŸ‡ª', code: '+58' },
            '60': { country: 'Malaysia', flag: 'ðŸ‡²ðŸ‡¾', code: '+60' },
            '61': { country: 'Australia', flag: 'ðŸ‡¦ðŸ‡º', code: '+61' },
            '62': { country: 'Indonesia', flag: 'ðŸ‡®ðŸ‡©', code: '+62' },
            '63': { country: 'Philippines', flag: 'ðŸ‡µðŸ‡­', code: '+63' },
            '64': { country: 'New Zealand', flag: 'ðŸ‡³ðŸ‡¿', code: '+64' },
            '65': { country: 'Singapore', flag: 'ðŸ‡¸ðŸ‡¬', code: '+65' },
            '66': { country: 'Thailand', flag: 'ðŸ‡¹ðŸ‡­', code: '+66' },
            '81': { country: 'Japan', flag: 'ðŸ‡¯ðŸ‡µ', code: '+81' },
            '82': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·', code: '+82' },
            '84': { country: 'Vietnam', flag: 'ðŸ‡»ðŸ‡³', code: '+84' },
            '86': { country: 'China', flag: 'ðŸ‡¨ðŸ‡³', code: '+86' },
            '90': { country: 'Turkey', flag: 'ðŸ‡¹ðŸ‡·', code: '+90' },
            '91': { country: 'India', flag: 'ðŸ‡®ðŸ‡³', code: '+91' },
            '92': { country: 'Pakistan', flag: 'ðŸ‡µðŸ‡°', code: '+92' },
            '93': { country: 'Afghanistan', flag: 'ðŸ‡¦ðŸ‡«', code: '+93' },
            '94': { country: 'Sri Lanka', flag: 'ðŸ‡±ðŸ‡°', code: '+94' },
            '95': { country: 'Myanmar', flag: 'ðŸ‡²ðŸ‡²', code: '+95' },
            '98': { country: 'Iran', flag: 'ðŸ‡®ðŸ‡·', code: '+98' },
            '212': { country: 'Morocco', flag: 'ðŸ‡²ðŸ‡¦', code: '+212' },
            '213': { country: 'Algeria', flag: 'ðŸ‡©ðŸ‡¿', code: '+213' },
            '216': { country: 'Tunisia', flag: 'ðŸ‡¹ðŸ‡³', code: '+216' },
            '218': { country: 'Libya', flag: 'ðŸ‡±ðŸ‡¾', code: '+218' },
            '220': { country: 'Gambia', flag: 'ðŸ‡¬ðŸ‡²', code: '+220' },
            '221': { country: 'Senegal', flag: 'ðŸ‡¸ðŸ‡³', code: '+221' },
            '234': { country: 'Nigeria', flag: 'ðŸ‡³ðŸ‡¬', code: '+234' },
            '254': { country: 'Kenya', flag: 'ðŸ‡°ðŸ‡ª', code: '+254' },
            '255': { country: 'Tanzania', flag: 'ðŸ‡¹ðŸ‡¿', code: '+255' },
            '256': { country: 'Uganda', flag: 'ðŸ‡ºðŸ‡¬', code: '+256' },
            '260': { country: 'Zambia', flag: 'ðŸ‡¿ðŸ‡²', code: '+260' },
            '263': { country: 'Zimbabwe', flag: 'ðŸ‡¿ðŸ‡¼', code: '+263' },
            '351': { country: 'Portugal', flag: 'ðŸ‡µðŸ‡¹', code: '+351' },
            '352': { country: 'Luxembourg', flag: 'ðŸ‡±ðŸ‡º', code: '+352' },
            '353': { country: 'Ireland', flag: 'ðŸ‡®ðŸ‡ª', code: '+353' },
            '354': { country: 'Iceland', flag: 'ðŸ‡®ðŸ‡¸', code: '+354' },
            '358': { country: 'Finland', flag: 'ðŸ‡«ðŸ‡®', code: '+358' },
            '370': { country: 'Lithuania', flag: 'ðŸ‡±ðŸ‡¹', code: '+370' },
            '371': { country: 'Latvia', flag: 'ðŸ‡±ðŸ‡»', code: '+371' },
            '372': { country: 'Estonia', flag: 'ðŸ‡ªðŸ‡ª', code: '+372' },
            '373': { country: 'Moldova', flag: 'ðŸ‡²ðŸ‡©', code: '+373' },
            '374': { country: 'Armenia', flag: 'ðŸ‡¦ðŸ‡²', code: '+374' },
            '375': { country: 'Belarus', flag: 'ðŸ‡§ðŸ‡¾', code: '+375' },
            '376': { country: 'Andorra', flag: 'ðŸ‡¦ðŸ‡©', code: '+376' },
            '377': { country: 'Monaco', flag: 'ðŸ‡²ðŸ‡¨', code: '+377' },
            '380': { country: 'Ukraine', flag: 'ðŸ‡ºðŸ‡¦', code: '+380' },
            '381': { country: 'Serbia', flag: 'ðŸ‡·ðŸ‡¸', code: '+381' },
            '385': { country: 'Croatia', flag: 'ðŸ‡­ðŸ‡·', code: '+385' },
            '386': { country: 'Slovenia', flag: 'ðŸ‡¸ðŸ‡®', code: '+386' },
            '387': { country: 'Bosnia', flag: 'ðŸ‡§ðŸ‡¦', code: '+387' },
            '389': { country: 'North Macedonia', flag: 'ðŸ‡²ðŸ‡°', code: '+389' },
            '420': { country: 'Czech Republic', flag: 'ðŸ‡¨ðŸ‡¿', code: '+420' },
            '421': { country: 'Slovakia', flag: 'ðŸ‡¸ðŸ‡°', code: '+421' },
            '880': { country: 'Bangladesh', flag: 'ðŸ‡§ðŸ‡©', code: '+880' },
            '886': { country: 'Taiwan', flag: 'ðŸ‡¹ðŸ‡¼', code: '+886' },
            '960': { country: 'Maldives', flag: 'ðŸ‡²ðŸ‡»', code: '+960' },
            '961': { country: 'Lebanon', flag: 'ðŸ‡±ðŸ‡§', code: '+961' },
            '962': { country: 'Jordan', flag: 'ðŸ‡¯ðŸ‡´', code: '+962' },
            '963': { country: 'Syria', flag: 'ðŸ‡¸ðŸ‡¾', code: '+963' },
            '964': { country: 'Iraq', flag: 'ðŸ‡®ðŸ‡¶', code: '+964' },
            '965': { country: 'Kuwait', flag: 'ðŸ‡°ðŸ‡¼', code: '+965' },
            '966': { country: 'Saudi Arabia', flag: 'ðŸ‡¸ðŸ‡¦', code: '+966' },
            '967': { country: 'Yemen', flag: 'ðŸ‡¾ðŸ‡ª', code: '+967' },
            '968': { country: 'Oman', flag: 'ðŸ‡´ðŸ‡²', code: '+968' },
            '970': { country: 'Palestine', flag: 'ðŸ‡µðŸ‡¸', code: '+970' },
            '971': { country: 'UAE', flag: 'ðŸ‡¦ðŸ‡ª', code: '+971' },
            '972': { country: 'Israel', flag: 'ðŸ‡®ðŸ‡±', code: '+972' },
            '973': { country: 'Bahrain', flag: 'ðŸ‡§ðŸ‡­', code: '+973' },
            '974': { country: 'Qatar', flag: 'ðŸ‡¶ðŸ‡¦', code: '+974' },
            '975': { country: 'Bhutan', flag: 'ðŸ‡§ðŸ‡¹', code: '+975' },
            '976': { country: 'Mongolia', flag: 'ðŸ‡²ðŸ‡³', code: '+976' },
            '977': { country: 'Nepal', flag: 'ðŸ‡³ðŸ‡µ', code: '+977' },
        };

        // Operator display names and colors
        const operatorInfo = {
            'Airtel': { logo: 'airtel', color: '#ed1c24', fullName: 'Bharti Airtel Limited' },
            'Vi (Vodafone Idea)': { logo: 'vi', color: '#e60000', fullName: 'Vodafone Idea Limited' },
            'Reliance Jio': { logo: 'jio', color: '#0a2885', fullName: 'Reliance Jio Infocomm Limited' },
            'Reliance Globalcom': { logo: 'jio', color: '#0a2885', fullName: 'Reliance Communications (Now Jio)' },
            'Reliance Communications': { logo: 'jio', color: '#0a2885', fullName: 'Reliance Communications Limited' },
            'BSNL': { logo: 'bsnl', color: '#ffc107', fullName: 'Bharat Sanchar Nigam Limited' },
            'MTNL': { logo: 'mtnl', color: '#00a0e3', fullName: 'Mahanagar Telephone Nigam Limited' },
            'Aircel': { logo: 'other', color: '#6b7280', fullName: 'Aircel Limited (Defunct)' },
        };

        // Load the Indian mobile database
        async function loadDatabase() {
            try {
                const response = await fetch('indianMobileDB.json');
                if (!response.ok) throw new Error('Failed to load database');
                indianMobileDB = await response.json();
                dbEntryCount = Object.keys(indianMobileDB).length;
                
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('phoneInput').disabled = false;
                document.getElementById('lookupBtn').disabled = false;
                document.getElementById('dbStatus').innerHTML = `<i class="fas fa-check-circle"></i> Database loaded: ${dbEntryCount.toLocaleString()} Indian mobile prefix records`;
                document.getElementById('dbStatus').style.color = 'var(--success-color)';
                
                // Check for URL parameter ?phone=
                checkUrlParams();
            } catch (error) {
                console.error('Error loading database:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('phoneInput').disabled = false;
                document.getElementById('lookupBtn').disabled = false;
                document.getElementById('dbStatus').innerHTML = `<i class="fas fa-exclamation-triangle"></i> Database load failed. Using basic lookup.`;
                document.getElementById('dbStatus').style.color = 'var(--warning-color)';
                checkUrlParams();
            }
        }

        // Check URL parameters for pre-filled phone number
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const phoneParam = urlParams.get('phone');
            if (phoneParam) {
                document.getElementById('phoneInput').value = phoneParam;
                lookupPhone();
            } else {
                document.getElementById('phoneInput').focus();
            }
        }

        // Load database on page load
        loadDatabase();

        function parsePhoneNumber(input) {
            // Remove all non-digit characters except +
            let cleaned = input.replace(/[^\d+]/g, '');
            
            // Handle different formats
            if (cleaned.startsWith('+')) {
                cleaned = cleaned.substring(1);
            } else if (cleaned.startsWith('00')) {
                cleaned = cleaned.substring(2);
            }
            
            // If 10 digits starting with 6-9, assume Indian number
            if (cleaned.length === 10 && cleaned.match(/^[6-9]/)) {
                return { countryCode: '91', nationalNumber: cleaned };
            }
            
            // Try to match country code (check longer codes first)
            for (let len = 3; len >= 1; len--) {
                const prefix = cleaned.substring(0, len);
                if (countryCodes[prefix]) {
                    return { countryCode: prefix, nationalNumber: cleaned.substring(len) };
                }
            }
            
            return { countryCode: null, nationalNumber: cleaned };
        }

        function lookupIndianOperator(nationalNumber) {
            if (nationalNumber.length < 4) return null;
            
            const prefix = nationalNumber.substring(0, 4);
            const dbEntry = indianMobileDB[prefix];
            
            if (dbEntry) {
                return {
                    operator: dbEntry.o,
                    circle: dbEntry.c,
                    prefix: prefix
                };
            }
            
            return null;
        }

        function getOperatorClass(operator) {
            if (!operator) return 'other';
            const op = operator.toLowerCase();
            if (op.includes('airtel')) return 'airtel';
            if (op.includes('jio') || op.includes('reliance')) return 'jio';
            if (op.includes('vi') || op.includes('vodafone') || op.includes('idea')) return 'vi';
            if (op.includes('bsnl')) return 'bsnl';
            if (op.includes('mtnl')) return 'mtnl';
            return 'other';
        }

        // Global variables to store API results for PDF/copy
        let lastJioResult = null;
        let lastBsnlResult = null;
        let lastAirtelResult = null;
        let lastViResult = null;

        // Helper functions for lookup spinner
        function showLookupSpinner(title, status) {
            document.getElementById('lookupSpinnerTitle').textContent = title || 'Looking up phone number...';
            document.getElementById('lookupSpinnerStatus').textContent = status || 'Checking carrier databases...';
            document.getElementById('lookupSpinner').classList.remove('hidden');
        }
        
        function updateLookupSpinner(title, status) {
            if (title) document.getElementById('lookupSpinnerTitle').textContent = title;
            if (status) document.getElementById('lookupSpinnerStatus').textContent = status;
        }
        
        function hideLookupSpinner() {
            document.getElementById('lookupSpinner').classList.add('hidden');
        }

        async function lookupPhone() {
            const input = document.getElementById('phoneInput').value.trim();
            
            if (!input) {
                showToast('Please enter a phone number');
                return;
            }

            const parsed = parsePhoneNumber(input);
            
            if (!parsed.nationalNumber || parsed.nationalNumber.length < 7) {
                showToast('Please enter a valid phone number');
                return;
            }

            // Show full-screen spinner
            showLookupSpinner('Looking up phone number...', 'Analyzing number format...');

            // Update URL with phone parameter
            const url = new URL(window.location);
            url.searchParams.set('phone', input);
            window.history.replaceState({}, '', url);

            // Reset API results
            lastJioResult = null;
            lastBsnlResult = null;
            document.getElementById('resultsSection').style.display = 'block';
            
            // Reset warning box to default
            document.getElementById('mnpWarningBox').innerHTML = `
                <h4><i class="fas fa-triangle-exclamation"></i> Important: Mobile Number Portability (MNP)</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>Numbers can be ported</strong> - The operator shown is based on original allocation and may not reflect current operator</li>
                    <li>In India, MNP allows users to switch operators while keeping their number</li>
                    <li>For accurate current operator information, official carrier verification is required</li>
                    <li>Circle/region information is based on original number allocation</li>
                    <li>Virtual numbers and VoIP services may show different information</li>
                </ul>
            `;
            document.getElementById('mnpWarningBox').style.borderColor = '';
            document.getElementById('mnpWarningBox').style.background = '';
            
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const resultSubtitle = document.getElementById('resultSubtitle');

            let countryInfo = parsed.countryCode ? countryCodes[parsed.countryCode] : null;
            let operatorInfo = null;

            // If Indian number, try to find operator from database
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                operatorInfo = lookupIndianOperator(parsed.nationalNumber);
            }

            if (countryInfo) {
                resultIcon.className = 'result-icon valid';
                resultIcon.innerHTML = '<span style="font-size: 32px;">' + countryInfo.flag + '</span>';
                resultTitle.textContent = countryInfo.country;
                resultSubtitle.textContent = operatorInfo ? `${operatorInfo.operator} - ${operatorInfo.circle}` : 'Country identified';
            } else {
                resultIcon.className = 'result-icon warning';
                resultIcon.innerHTML = '<i class="fas fa-question"></i>';
                resultTitle.textContent = 'Unknown Country';
                resultSubtitle.textContent = 'Could not determine country from number';
            }

            let formattedNumber = parsed.countryCode ? `+${parsed.countryCode} ${parsed.nationalNumber}` : parsed.nationalNumber;

            let detailsHTML = `
                <div class="detail-item">
                    <div class="detail-label">Phone Number</div>
                    <div class="detail-value" style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem;">${formattedNumber}</div>
                </div>
            `;

            if (parsed.countryCode) {
                detailsHTML += `
                    <div class="detail-item">
                        <div class="detail-label">Country Code</div>
                        <div class="detail-value">+${parsed.countryCode}</div>
                    </div>
                `;
            }

            if (countryInfo) {
                detailsHTML += `
                    <div class="detail-item">
                        <div class="detail-label">Country</div>
                        <div class="detail-value">${countryInfo.flag} ${countryInfo.country}</div>
                    </div>
                `;
            }

            if (operatorInfo) {
                const opClass = getOperatorClass(operatorInfo.operator);
                detailsHTML += `
                    <div class="detail-item">
                        <div class="detail-label">Original Operator</div>
                        <div class="detail-value">
                            <span class="operator-logo ${opClass}">
                                <i class="fas fa-broadcast-tower"></i> ${operatorInfo.operator}
                            </span>
                        </div>
                    </div>
                    <div class="detail-item" id="currentOperatorRow" style="display: none;">
                        <div class="detail-label">Current Operator</div>
                        <div class="detail-value" id="currentOperatorValue"></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Telecom Circle</div>
                        <div class="detail-value">${operatorInfo.circle || 'Unknown'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Number Prefix</div>
                        <div class="detail-value" style="font-family: 'JetBrains Mono', monospace;">${operatorInfo.prefix}</div>
                    </div>
                `;
            } else if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                // Indian number not in database - show current operator placeholder
                detailsHTML += `
                    <div class="detail-item">
                        <div class="detail-label">Original Operator</div>
                        <div class="detail-value" style="color: var(--text-secondary);">
                            <i class="fas fa-question-circle"></i> Not in database
                        </div>
                    </div>
                    <div class="detail-item" id="currentOperatorRow" style="display: none;">
                        <div class="detail-label">Current Operator</div>
                        <div class="detail-value" id="currentOperatorValue"></div>
                    </div>
                `;
            }

            detailsHTML += `
                <div class="detail-item">
                    <div class="detail-label">Number Length</div>
                    <div class="detail-value">${parsed.nationalNumber.length} digits (national)</div>
                </div>
            `;

            // Number type detection
            let numberType = 'Unknown';
            if (parsed.countryCode === '91') {
                if (parsed.nationalNumber.match(/^[6-9]/)) {
                    numberType = 'Mobile';
                } else if (parsed.nationalNumber.match(/^[1-5]/)) {
                    numberType = 'Landline';
                }
            }

            detailsHTML += `
                <div class="detail-item">
                    <div class="detail-label">Number Type</div>
                    <div class="detail-value">${numberType}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Lookup Time</div>
                    <div class="detail-value">${new Date().toLocaleString()}</div>
                </div>
            `;

            document.getElementById('resultDetails').innerHTML = detailsHTML;

            // Operator breakdown visualization
            let breakdownHTML = '';
            if (operatorInfo) {
                const parts = parsed.nationalNumber.match(/.{1,2}/g) || [];
                breakdownHTML = `
                    <h4 style="margin-bottom: 15px; color: var(--text-primary);"><i class="fas fa-puzzle-piece"></i> Number Structure</h4>
                    <div style="display: flex; gap: 5px; font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; flex-wrap: wrap; justify-content: center;">
                        <div style="background: rgba(34, 211, 238, 0.3); padding: 15px; border-radius: 8px; border: 2px solid rgba(34, 211, 238, 0.5); text-align: center;">
                            <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 5px;">Operator/Circle Code</div>
                            ${parsed.nationalNumber.substring(0, 4)}
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.3); padding: 15px; border-radius: 8px; border: 2px solid rgba(16, 185, 129, 0.5); text-align: center;">
                            <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 5px;">Subscriber Number</div>
                            ${parsed.nationalNumber.substring(4)}
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; text-align: center; font-size: 0.85rem; color: var(--text-secondary);">
                        <i class="fas fa-database"></i> Database contains <strong>${dbEntryCount.toLocaleString()}</strong> Indian mobile prefix records from DoT/TRAI data
                    </div>
                `;
            } else if (parsed.countryCode === '91') {
                breakdownHTML = `
                    <div style="padding: 15px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; text-align: center;">
                        <i class="fas fa-info-circle" style="color: var(--warning-color);"></i>
                        <span style="color: var(--warning-color); margin-left: 10px;">Operator information not found in database. This prefix may be newly allocated or the number may be invalid.</span>
                    </div>
                `;
            }
            
            document.getElementById('operatorBreakdown').innerHTML = breakdownHTML;
            
            // Jio Live Check for Indian mobile numbers
            const jioLiveSection = document.getElementById('jioLiveCheck');
            const jioCheckContent = document.getElementById('jioCheckContent');
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10 && parsed.nationalNumber.match(/^[6-9]/)) {
                updateLookupSpinner('Verifying carrier...', 'Checking Jio network status...');
                jioLiveSection.style.display = 'block';
                jioCheckContent.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                        <p style="color: var(--text-secondary);">Checking Jio network status...</p>
                    </div>
                `;
                
                // Call Jio API
                try {
                    const response = await fetch(`/reliancejioapi/${parsed.nationalNumber}`);
                    const jioData = await response.json();
                    lastJioResult = jioData;
                    
                    if (jioData.isJio) {
                        const billingTypeColor = jioData.isPrepaid ? '#10b981' : '#f59e0b';
                        const billingTypeIcon = jioData.isPrepaid ? 'fa-mobile-alt' : 'fa-file-invoice-dollar';
                        
                        jioCheckContent.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: rgba(10, 185, 129, 0.2); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #10b981; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Network Status</div>
                                    <div style="font-weight: 600; color: #10b981;">Active Jio User</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.2); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.4);">
                                    <i class="fas ${billingTypeIcon}" style="font-size: 1.5rem; color: ${billingTypeColor}; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Billing Type</div>
                                    <div style="font-weight: 600; color: ${billingTypeColor};">${jioData.billingType || 'Unknown'}</div>
                                </div>
                                ${jioData.isPrimeMember !== undefined ? `
                                <div style="text-align: center; padding: 15px; background: rgba(245, 158, 11, 0.2); border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.4);">
                                    <i class="fas ${jioData.isPrimeMember ? 'fa-crown' : 'fa-user'}" style="font-size: 1.5rem; color: ${jioData.isPrimeMember ? '#f59e0b' : '#6b7280'}; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Prime Status</div>
                                    <div style="font-weight: 600; color: ${jioData.isPrimeMember ? '#f59e0b' : '#6b7280'};">${jioData.isPrimeMember ? 'Prime Member' : 'Non-Prime'}</div>
                                </div>
                                ` : ''}
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; text-align: center; font-size: 0.8rem; color: var(--text-secondary);">
                                <i class="fas fa-info-circle"></i> This is live data from Jio network. The number is <strong>currently active</strong> on Jio.
                            </div>
                        `;
                        
                        // Show current operator as Jio
                        const currentOpRow = document.getElementById('currentOperatorRow');
                        if (currentOpRow) {
                            currentOpRow.style.display = 'grid';
                            document.getElementById('currentOperatorValue').innerHTML = `
                                <span class="operator-logo jio" style="background: linear-gradient(135deg, #0a2885, #1a47c0);">
                                    <i class="fas fa-check-circle"></i> Reliance Jio (Verified)
                                </span>
                            `;
                        }
                        
                        // Hide BSNL section since Jio is confirmed
                        document.getElementById('bsnlLiveCheck').style.display = 'none';
                        
                        // Update warning box to show confirmed Jio
                        document.getElementById('mnpWarningBox').innerHTML = `
                            <h4 style="color: #10b981;"><i class="fas fa-check-circle"></i> Verified: Jio Network Confirmed</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Live verification successful</strong> - This number is CONFIRMED to be currently active on Reliance Jio network</li>
                                <li>Billing Type: <strong>${jioData.billingType || 'Unknown'}</strong></li>
                                ${jioData.isPrimeMember !== undefined ? `<li>Prime Member: <strong>${jioData.isPrimeMember ? 'Yes' : 'No'}</strong></li>` : ''}
                                <li>The original operator from database may differ due to MNP (porting to Jio)</li>
                                <li>Circle/region information is still based on original allocation</li>
                            </ul>
                        `;
                        document.getElementById('mnpWarningBox').style.borderColor = '#10b981';
                        document.getElementById('mnpWarningBox').style.background = 'rgba(16, 185, 129, 0.1)';
                    } else {
                        jioCheckContent.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(107, 114, 128, 0.2); border-radius: 8px; border: 1px solid rgba(107, 114, 128, 0.4);">
                                <i class="fas fa-times-circle" style="font-size: 2rem; color: #6b7280;"></i>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Not a Jio Number</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">This number is not currently active on Jio network</div>
                                </div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Jio API error:', error);
                    jioCheckContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Could not check Jio status</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">API unavailable or network error. Try again later.</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                jioLiveSection.style.display = 'none';
            }
            
            // Skip BSNL check if Jio is already confirmed
            if (lastJioResult && lastJioResult.isJio) {
                hideLookupSpinner();
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // BSNL Live Check for Indian mobile numbers
            const bsnlLiveSection = document.getElementById('bsnlLiveCheck');
            const bsnlCheckContent = document.getElementById('bsnlCheckContent');
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10 && parsed.nationalNumber.match(/^[6-9]/)) {
                updateLookupSpinner('Verifying carrier...', 'Checking BSNL network status...');
                bsnlLiveSection.style.display = 'block';
                bsnlCheckContent.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                        <p style="color: var(--text-secondary);">Checking BSNL network status...</p>
                    </div>
                `;
                
                // Call BSNL API
                try {
                    const bsnlResponse = await fetch(`/bsnlapi/${parsed.nationalNumber}`);
                    const bsnlData = await bsnlResponse.json();
                    lastBsnlResult = bsnlData;
                    
                    if (bsnlData.isBsnl) {
                        let plansHTML = '';
                        if (bsnlData.topPlans && bsnlData.topPlans.length > 0) {
                            plansHTML = `
                                <div style="margin-top: 15px;">
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 10px;"><i class="fas fa-tag"></i> Top Recharge Plans:</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        ${bsnlData.topPlans.slice(0, 4).map(plan => `
                                            <div style="padding: 8px 12px; background: rgba(255, 193, 7, 0.2); border-radius: 6px; font-size: 0.8rem;">
                                                <strong>â‚¹${plan.amount}</strong> - ${plan.validity}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }
                        
                        bsnlCheckContent.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #10b981; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Network Status</div>
                                    <div style="font-weight: 600; color: #10b981;">Active BSNL User</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(255, 193, 7, 0.2); border-radius: 8px; border: 1px solid rgba(255, 193, 7, 0.4);">
                                    <i class="fas fa-map-marker-alt" style="font-size: 1.5rem; color: #f59e0b; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Circle</div>
                                    <div style="font-weight: 600; color: #f59e0b;">${bsnlData.circle || 'Unknown'}</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.2); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.4);">
                                    <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: #6366f1; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Type</div>
                                    <div style="font-weight: 600; color: #6366f1;">Prepaid</div>
                                </div>
                            </div>
                            ${plansHTML}
                            <div style="margin-top: 15px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; text-align: center; font-size: 0.8rem; color: var(--text-secondary);">
                                <i class="fas fa-info-circle"></i> This is live data from BSNL network. The number is <strong>currently active</strong> on BSNL.
                            </div>
                        `;
                        
                        // Show current operator as BSNL
                        const currentOpRow = document.getElementById('currentOperatorRow');
                        if (currentOpRow) {
                            currentOpRow.style.display = 'grid';
                            document.getElementById('currentOperatorValue').innerHTML = `
                                <span class="operator-logo bsnl" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                                    <i class="fas fa-check-circle"></i> BSNL (Verified)
                                </span>
                            `;
                        }
                        
                        // Hide Jio section since BSNL is confirmed
                        document.getElementById('jioLiveCheck').style.display = 'none';
                        
                        // Update warning box to show confirmed BSNL
                        document.getElementById('mnpWarningBox').innerHTML = `
                            <h4 style="color: #f59e0b;"><i class="fas fa-check-circle"></i> Verified: BSNL Network Confirmed</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Live verification successful</strong> - This number is CONFIRMED to be currently active on BSNL network</li>
                                <li>Circle: <strong>${bsnlData.circle || 'Unknown'}</strong></li>
                                <li>The original operator from database may differ due to MNP (porting to BSNL)</li>
                                <li>Circle/region information is from BSNL live data</li>
                            </ul>
                        `;
                        document.getElementById('mnpWarningBox').style.borderColor = '#f59e0b';
                        document.getElementById('mnpWarningBox').style.background = 'rgba(245, 158, 11, 0.1)';
                    } else {
                        bsnlCheckContent.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(107, 114, 128, 0.2); border-radius: 8px; border: 1px solid rgba(107, 114, 128, 0.4);">
                                <i class="fas fa-times-circle" style="font-size: 2rem; color: #6b7280;"></i>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Not a BSNL Number</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">This number is not currently active on BSNL network</div>
                                </div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('BSNL API error:', error);
                    bsnlCheckContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Could not check BSNL status</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">API unavailable or network error. Try again later.</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                bsnlLiveSection.style.display = 'none';
            }
            
            // Skip Airtel check if Jio or BSNL is already confirmed
            if ((lastJioResult && lastJioResult.isJio) || (lastBsnlResult && lastBsnlResult.isBsnl)) {
                hideLookupSpinner();
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // Airtel Live Check for Indian mobile numbers
            const airtelLiveSection = document.getElementById('airtelLiveCheck');
            const airtelCheckContent = document.getElementById('airtelCheckContent');
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10 && parsed.nationalNumber.match(/^[6-9]/)) {
                updateLookupSpinner('Verifying carrier...', 'Checking Airtel network status...');
                airtelLiveSection.style.display = 'block';
                airtelCheckContent.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                        <p style="color: var(--text-secondary);">Checking Airtel network status...</p>
                    </div>
                `;
                
                // Call Airtel API
                try {
                    const airtelResponse = await fetch(`/airtelapi/${parsed.nationalNumber}?t=${Date.now()}`);
                    const airtelData = await airtelResponse.json();
                    lastAirtelResult = airtelData;
                    
                    if (airtelData.isAirtel) {
                        const statusColor = airtelData.status === 'ACTIV' ? '#10b981' : '#f59e0b';
                        const statusIcon = airtelData.status === 'ACTIV' ? 'fa-check-circle' : 'fa-clock';
                        const statusText = airtelData.status === 'ACTIV' ? 'Active' : (airtelData.status || 'Unknown');
                        
                        airtelCheckContent.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #10b981; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Network Status</div>
                                    <div style="font-weight: 600; color: #10b981;">Active Airtel User</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(237, 28, 36, 0.2); border-radius: 8px; border: 1px solid rgba(237, 28, 36, 0.4);">
                                    <i class="fas fa-map-marker-alt" style="font-size: 1.5rem; color: #ed1c24; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Circle</div>
                                    <div style="font-weight: 600; color: #ed1c24;">${airtelData.circleName || 'Circle ' + airtelData.circleId || 'Unknown'}</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.2); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.4);">
                                    <i class="fas ${statusIcon}" style="font-size: 1.5rem; color: ${statusColor}; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Status</div>
                                    <div style="font-weight: 600; color: ${statusColor};">${statusText}</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; text-align: center; font-size: 0.8rem; color: var(--text-secondary);">
                                <i class="fas fa-info-circle"></i> This is live data from Airtel network. The number is <strong>currently active</strong> on Airtel.
                            </div>
                        `;
                        
                        // Show current operator as Airtel
                        const currentOpRow = document.getElementById('currentOperatorRow');
                        if (currentOpRow) {
                            currentOpRow.style.display = 'grid';
                            document.getElementById('currentOperatorValue').innerHTML = `
                                <span class="operator-logo airtel" style="background: linear-gradient(135deg, #ed1c24, #b40000);">
                                    <i class="fas fa-check-circle"></i> Airtel (Verified)
                                </span>
                            `;
                        }
                        
                        // Hide Jio and BSNL sections since Airtel is confirmed
                        document.getElementById('jioLiveCheck').style.display = 'none';
                        document.getElementById('bsnlLiveCheck').style.display = 'none';
                        
                        // Update warning box to show confirmed Airtel
                        document.getElementById('mnpWarningBox').innerHTML = `
                            <h4 style="color: #ed1c24;"><i class="fas fa-check-circle"></i> Verified: Airtel Network Confirmed</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Live verification successful</strong> - This number is CONFIRMED to be currently active on Airtel network</li>
                                <li>Circle: <strong>${airtelData.circleName || 'Unknown'}</strong></li>
                                <li>Status: <strong>${statusText}</strong></li>
                                <li>The original operator from database may differ due to MNP (porting to Airtel)</li>
                                <li>Circle/region information is from Airtel live data</li>
                            </ul>
                        `;
                        document.getElementById('mnpWarningBox').style.borderColor = '#ed1c24';
                        document.getElementById('mnpWarningBox').style.background = 'rgba(237, 28, 36, 0.1)';
                    } else {
                        airtelCheckContent.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(107, 114, 128, 0.2); border-radius: 8px; border: 1px solid rgba(107, 114, 128, 0.4);">
                                <i class="fas fa-times-circle" style="font-size: 2rem; color: #6b7280;"></i>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Not an Airtel Number</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">This number is not currently active on Airtel network</div>
                                </div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Airtel API error:', error);
                    airtelCheckContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Could not check Airtel status</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">API unavailable or network error. Try again later.</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                airtelLiveSection.style.display = 'none';
            }
            
            // Skip Vi check if Jio, BSNL or Airtel is already confirmed
            if ((lastJioResult && lastJioResult.isJio) || (lastBsnlResult && lastBsnlResult.isBsnl) || (lastAirtelResult && lastAirtelResult.isAirtel)) {
                hideLookupSpinner();
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // Vi Live Check for Indian mobile numbers
            const viLiveSection = document.getElementById('viLiveCheck');
            const viCheckContent = document.getElementById('viCheckContent');
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10 && parsed.nationalNumber.match(/^[6-9]/)) {
                updateLookupSpinner('Verifying carrier...', 'Checking Vi network status...');
                viLiveSection.style.display = 'block';
                viCheckContent.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                        <p style="color: var(--text-secondary);">Checking Vi network status...</p>
                    </div>
                `;
                
                // Call Vi API with retry logic
                const maxRetries = 3;
                let viData = null;
                let lastError = null;
                
                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        if (attempt > 1) {
                            viCheckContent.innerHTML = `
                                <div style="text-align: center; padding: 20px;">
                                    <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                                    <p style="color: var(--text-secondary);">Checking Vi network status... (Attempt ${attempt}/${maxRetries})</p>
                                </div>
                            `;
                            // Small delay between retries
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                        
                        const viResponse = await fetch(`/viapi/${parsed.nationalNumber}?t=${Date.now()}`);
                        const responseData = await viResponse.json();
                        
                        // Check if it's an actual success response (not an API failure from Vi)
                        // Retry if: HTTP error, has error field, OR status is FAILURE (Vi API returned failure)
                        if (viResponse.ok && responseData && !responseData.error && responseData.status !== 'FAILURE') {
                            viData = responseData;
                            lastViResult = viData;
                            break; // Success, exit retry loop
                        } else if (responseData.status === 'FAILURE') {
                            // Vi API returned FAILURE - retry
                            console.warn(`Vi API attempt ${attempt}: Vi returned FAILURE, retrying...`);
                            lastError = new Error('Vi API returned FAILURE');
                        } else {
                            lastError = new Error(responseData.error || 'API returned error');
                        }
                    } catch (error) {
                        console.warn(`Vi API attempt ${attempt} failed:`, error);
                        lastError = error;
                    }
                }
                
                // Process the result
                if (viData) {
                    if (viData.isVi) {
                        const statusColor = viData.custStatus === 'NOTSUSPENDED' ? '#10b981' : '#f59e0b';
                        const statusText = viData.custStatus === 'NOTSUSPENDED' ? 'Active' : (viData.custStatus || 'Unknown');
                        const typeColor = viData.subscriberType === 'PREPAID' ? '#10b981' : '#6366f1';
                        
                        viCheckContent.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #10b981; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Network Status</div>
                                    <div style="font-weight: 600; color: #10b981;">Active Vi User</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(255, 0, 102, 0.2); border-radius: 8px; border: 1px solid rgba(255, 0, 102, 0.4);">
                                    <i class="fas fa-map-marker-alt" style="font-size: 1.5rem; color: #ff0066; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Circle</div>
                                    <div style="font-weight: 600; color: #ff0066;">${viData.circleName || viData.circle || 'Unknown'}</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.2); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.4);">
                                    <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: ${typeColor}; margin-bottom: 8px;"></i>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Type</div>
                                    <div style="font-weight: 600; color: ${typeColor};">${viData.subscriberType || 'Unknown'}</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px; text-align: center; font-size: 0.8rem; color: var(--text-secondary);">
                                <i class="fas fa-info-circle"></i> This is live data from Vi network. The number is <strong>currently active</strong> on Vi (${viData.brand || 'Vodafone Idea'}).
                            </div>
                            <details style="margin-top: 15px;">
                                <summary style="cursor: pointer; padding: 10px; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                    <i class="fas fa-code"></i> Raw API Response (Click to expand)
                                </summary>
                                <pre style="margin-top: 10px; padding: 12px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.75rem; color: var(--text-secondary); overflow-x: auto; white-space: pre-wrap; word-break: break-all;">${JSON.stringify(viData, null, 2)}</pre>
                            </details>
                        `;
                        
                        // Show current operator as Vi
                        const currentOpRow = document.getElementById('currentOperatorRow');
                        if (currentOpRow) {
                            currentOpRow.style.display = 'grid';
                            document.getElementById('currentOperatorValue').innerHTML = `
                                <span class="operator-logo vi" style="background: linear-gradient(135deg, #ff0066, #9900cc);">
                                    <i class="fas fa-check-circle"></i> Vi (Verified)
                                </span>
                            `;
                        }
                        
                        // Hide other sections since Vi is confirmed
                        document.getElementById('jioLiveCheck').style.display = 'none';
                        document.getElementById('bsnlLiveCheck').style.display = 'none';
                        document.getElementById('airtelLiveCheck').style.display = 'none';
                        
                        // Update warning box to show confirmed Vi
                        document.getElementById('mnpWarningBox').innerHTML = `
                            <h4 style="color: #ff0066;"><i class="fas fa-check-circle"></i> Verified: Vi Network Confirmed</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Live verification successful</strong> - This number is CONFIRMED to be currently active on Vi (${viData.brand || 'Vodafone Idea'}) network</li>
                                <li>Circle: <strong>${viData.circleName || viData.circle || 'Unknown'}</strong></li>
                                <li>Type: <strong>${viData.subscriberType || 'Unknown'}</strong></li>
                                <li>The original operator from database may differ due to MNP (porting to Vi)</li>
                                <li>Circle/region information is from Vi live data</li>
                            </ul>
                        `;
                        document.getElementById('mnpWarningBox').style.borderColor = '#ff0066';
                        document.getElementById('mnpWarningBox').style.background = 'rgba(255, 0, 102, 0.1)';
                    } else {
                        viCheckContent.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(107, 114, 128, 0.2); border-radius: 8px; border: 1px solid rgba(107, 114, 128, 0.4);">
                                <i class="fas fa-times-circle" style="font-size: 2rem; color: #6b7280;"></i>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Not a Vi Number</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">This number is not currently active on Vi network</div>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    // All retries failed
                    console.error('Vi API error after all retries:', lastError);
                    viCheckContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #ef4444;"></i>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Could not check Vi status</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">API unavailable after ${maxRetries} attempts. Try again later.</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                viLiveSection.style.display = 'none';
            }
            
            // If none of the operators are confirmed, show as Other/MVNO
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10 && 
                (!lastJioResult || !lastJioResult.isJio) && (!lastBsnlResult || !lastBsnlResult.isBsnl) && 
                (!lastAirtelResult || !lastAirtelResult.isAirtel) && (!lastViResult || !lastViResult.isVi)) {
                
                const currentOpRow = document.getElementById('currentOperatorRow');
                if (currentOpRow) {
                    currentOpRow.style.display = 'grid';
                    document.getElementById('currentOperatorValue').innerHTML = `
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <span style="padding: 4px 12px; background: rgba(107, 114, 128, 0.2); border-radius: 20px; font-size: 0.85rem; color: var(--text-secondary);">
                                <i class="fas fa-question-circle"></i> Other/MVNO/Invalid
                            </span>
                            <span style="font-size: 0.75rem; color: var(--text-secondary);">(Not Jio/BSNL/Airtel/Vi)</span>
                        </div>
                    `;
                }
            }
            
            // Hide the lookup spinner when all checks are complete
            hideLookupSpinner();
            
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function copyResult() {
            const input = document.getElementById('phoneInput').value.trim();
            const parsed = parsePhoneNumber(input);
            const countryInfo = parsed.countryCode ? countryCodes[parsed.countryCode] : null;
            let operatorData = null;
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                operatorData = lookupIndianOperator(parsed.nationalNumber);
            }
            
            let text = `Phone Number Lookup Report\n`;
            text += `==========================\n`;
            text += `Generated: ${new Date().toLocaleString()}\n\n`;
            text += `Number: +${parsed.countryCode || ''} ${parsed.nationalNumber}\n`;
            text += `Country: ${countryInfo ? countryInfo.country : 'Unknown'}\n`;
            if (operatorData) {
                text += `Original Operator: ${operatorData.operator}\n`;
                text += `Circle: ${operatorData.circle || 'Unknown'}\n`;
                text += `Prefix: ${operatorData.prefix}\n`;
            }
            
            // Current operator determination
            if (lastJioResult && lastJioResult.isJio) {
                text += `Current Operator: Reliance Jio (Verified)\n`;
                text += `\n--- Jio Live Status ---\n`;
                text += `Billing Type: ${lastJioResult.billingType || 'Unknown'}\n`;
                if (lastJioResult.isPrimeMember !== undefined) {
                    text += `Prime Member: ${lastJioResult.isPrimeMember ? 'Yes' : 'No'}\n`;
                }
            } else if (lastBsnlResult && lastBsnlResult.isBsnl) {
                text += `Current Operator: BSNL (Verified)\n`;
                text += `\n--- BSNL Live Status ---\n`;
                text += `Circle: ${lastBsnlResult.circle || 'Unknown'}\n`;
                text += `Type: Prepaid\n`;
            } else if (lastAirtelResult && lastAirtelResult.isAirtel) {
                text += `Current Operator: Airtel (Verified)\n`;
                text += `\n--- Airtel Live Status ---\n`;
                text += `Circle: ${lastAirtelResult.circleName || 'Unknown'}\n`;
                text += `Status: ${lastAirtelResult.status || 'Unknown'}\n`;
            } else if (lastViResult && lastViResult.isVi) {
                text += `Current Operator: Vi (Verified)\n`;
                text += `\n--- Vi Live Status ---\n`;
                text += `Circle: ${lastViResult.circleName || lastViResult.circle || 'Unknown'}\n`;
                text += `Type: ${lastViResult.subscriberType || 'Unknown'}\n`;
                text += `Brand: ${lastViResult.brand || 'Vodafone Idea'}\n`;
            } else if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                text += `Current Operator: Other/MVNO/Invalid (Not Jio/BSNL/Airtel/Vi)\n`;
            }
            
            text += `\nNote: Original operator info is based on allocation. Current operator verified via live APIs where possible.\n`;
            text += `\n--------------------------\n`;
            text += `Generated by Punjab Investigation Tools\n`;
            text += `https://punjab.pages.dev\n`;
            text += `Database: ${dbEntryCount.toLocaleString()} Indian mobile prefix records`;
            
            navigator.clipboard.writeText(text);
            showToast('Result copied to clipboard');
        }

        async function downloadPDF() {
            showToast('Generating PDF...');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const input = document.getElementById('phoneInput').value.trim();
            const parsed = parsePhoneNumber(input);
            const countryInfo = parsed.countryCode ? countryCodes[parsed.countryCode] : null;
            let operatorData = null;
            
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                operatorData = lookupIndianOperator(parsed.nationalNumber);
            }
            
            // Header
            doc.setFillColor(26, 26, 46);
            doc.rect(0, 0, 210, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.text('Phone Number Lookup Report', 20, 25);
            
            doc.setFontSize(10);
            doc.text('Punjab Investigation Tools', 150, 15);
            doc.text(new Date().toLocaleString(), 150, 22);
            
            // Content
            doc.setTextColor(0, 0, 0);
            let y = 55;
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Phone Number Details', 20, y);
            y += 15;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            
            const addLine = (label, value) => {
                doc.setFont(undefined, 'bold');
                doc.text(`${label}:`, 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(String(value), 80, y);
                y += 8;
            };
            
            addLine('Phone Number', `+${parsed.countryCode || ''} ${parsed.nationalNumber}`);
            addLine('Country Code', `+${parsed.countryCode || 'Unknown'}`);
            addLine('Country', countryInfo ? countryInfo.country : 'Unknown');
            
            if (operatorData) {
                y += 5;
                doc.setFont(undefined, 'bold');
                doc.text('Indian Operator Details', 20, y);
                y += 10;
                doc.setFont(undefined, 'normal');
                
                addLine('Original Operator', operatorData.operator);
                addLine('Telecom Circle', operatorData.circle || 'Unknown');
                addLine('Number Prefix', operatorData.prefix);
            }
            
            // Current Operator
            if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                y += 5;
                doc.setFont(undefined, 'bold');
                doc.text('Current Operator Status', 20, y);
                y += 10;
                doc.setFont(undefined, 'normal');
                
                if (lastJioResult && lastJioResult.isJio) {
                    addLine('Current Operator', 'Reliance Jio (Verified)');
                    addLine('Billing Type', lastJioResult.billingType || 'Unknown');
                    if (lastJioResult.isPrimeMember !== undefined) {
                        addLine('Prime Member', lastJioResult.isPrimeMember ? 'Yes' : 'No');
                    }
                } else if (lastBsnlResult && lastBsnlResult.isBsnl) {
                    addLine('Current Operator', 'BSNL (Verified)');
                    addLine('BSNL Circle', lastBsnlResult.circle || 'Unknown');
                    addLine('Type', 'Prepaid');
                } else if (lastAirtelResult && lastAirtelResult.isAirtel) {
                    addLine('Current Operator', 'Airtel (Verified)');
                    addLine('Airtel Circle', lastAirtelResult.circleName || 'Unknown');
                    addLine('Status', lastAirtelResult.status || 'Unknown');
                } else if (lastViResult && lastViResult.isVi) {
                    addLine('Current Operator', 'Vi (Verified)');
                    addLine('Vi Circle', lastViResult.circleName || lastViResult.circle || 'Unknown');
                    addLine('Type', lastViResult.subscriberType || 'Unknown');
                    addLine('Brand', lastViResult.brand || 'Vodafone Idea');
                } else {
                    addLine('Current Operator', 'Other/MVNO/Invalid');
                    addLine('Note', 'Not Jio/BSNL/Airtel/Vi');
                }
            }
            
            y += 10;
            
            // Warning/Info box
            if (lastJioResult && lastJioResult.isJio) {
                // Confirmed Jio - show green box
                doc.setFillColor(209, 250, 229);
                doc.rect(15, y, 180, 25, 'F');
                doc.setTextColor(6, 95, 70);
                doc.setFontSize(10);
                doc.text('Verified Jio Number:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('This number is CONFIRMED to be currently active on Jio network (Live API check).', 20, y + 18);
            } else if (lastBsnlResult && lastBsnlResult.isBsnl) {
                // Confirmed BSNL - show yellow-green box
                doc.setFillColor(254, 249, 195);
                doc.rect(15, y, 180, 25, 'F');
                doc.setTextColor(133, 77, 14);
                doc.setFontSize(10);
                doc.text('Verified BSNL Number:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('This number is CONFIRMED to be currently active on BSNL network (Live API check).', 20, y + 18);
            } else if (lastAirtelResult && lastAirtelResult.isAirtel) {
                // Confirmed Airtel - show red box
                doc.setFillColor(254, 226, 226);
                doc.rect(15, y, 180, 25, 'F');
                doc.setTextColor(153, 27, 27);
                doc.setFontSize(10);
                doc.text('Verified Airtel Number:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('This number is CONFIRMED to be currently active on Airtel network (Live API check).', 20, y + 18);
            } else if (lastViResult && lastViResult.isVi) {
                // Confirmed Vi - show pink/purple box
                doc.setFillColor(252, 231, 243);
                doc.rect(15, y, 180, 25, 'F');
                doc.setTextColor(157, 23, 77);
                doc.setFontSize(10);
                doc.text('Verified Vi Number:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('This number is CONFIRMED to be currently active on Vi network (Live API check).', 20, y + 18);
            } else if (parsed.countryCode === '91' && parsed.nationalNumber.length === 10) {
                // Indian number not any operator
                doc.setFillColor(229, 231, 235);
                doc.rect(15, y, 180, 25, 'F');
                doc.setTextColor(75, 85, 99);
                doc.setFontSize(10);
                doc.text('Other/MVNO/Invalid Number:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('This number is NOT on Jio, BSNL, Airtel or Vi. May be MVNO or invalid.', 20, y + 18);
            } else {
                // Non-Indian or unknown
                doc.setFillColor(255, 243, 205);
                doc.rect(15, y, 180, 30, 'F');
                doc.setTextColor(133, 77, 14);
                doc.setFontSize(10);
                doc.text('Important Notice:', 20, y + 10);
                doc.setFontSize(9);
                doc.text('The operator shown is based on original allocation. Due to Mobile Number', 20, y + 18);
                doc.text('Portability (MNP), the current operator may be different.', 20, y + 24);
            }
            
            // Footer
            doc.setTextColor(128, 128, 128);
            doc.setFontSize(9);
            doc.text(`Database: ${dbEntryCount.toLocaleString()} Indian mobile prefix records | Generated by Punjab Investigation Tools`, 20, 275);
            doc.setTextColor(59, 130, 246);
            doc.textWithLink('https://punjab.pages.dev', 20, 282, { url: 'https://punjab.pages.dev' });
            
            doc.save(`Phone_Lookup_${parsed.nationalNumber}.pdf`);
            showToast('PDF downloaded successfully');
        }

        function resetForm() {
            document.getElementById('phoneInput').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('phoneInput').focus();
            // Reset API results
            lastJioResult = null;
            lastBsnlResult = null;
            lastAirtelResult = null;
            lastViResult = null;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        document.getElementById('phoneInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') lookupPhone();
        });
    </script>
</body>
</html>
